<!DOCTYPE html>
<meta charset="utf-8">
<style>


.counties {
  fill: none;
}



.q0-15:hover,
.q1-15:hover,
.q2-15:hover,
.q3-15:hover,
.q4-15:hover,
.q5-15:hover,
.q6-15:hover,
.q7-15:hover,
.q8-15:hover,
.q9-15:hover,
.q10-15:hover,
.q11-15:hover,
.q12-15:hover,
.q13-15:hover,
.q14-15:hover{
  opacity: 0.7;
}

.q0-15, 
.q1-15,
.q2-15,
.q3-15,
.q4-15,
.q5-15,
.q6-15,
.q7-15,
.q8-15,
.q9-15,
.q10-15,
.q11-15,
.q12-15,
.q13-15,
.q14-15{
  stroke: #606060 ;
  stroke-width: .5px;
}
div.tooltip {
  position: absolute;
  text-align: center;
  width: 75px;
  padding: 2px;
  font: 12px sans-serif;
  color: white;
  background: black;
  border: 0px;
  border-radius: 8px;
  pointer-events: none;
}

.q0-15 { fill:#e0524a; }
.q1-15 { fill:#e4695b; }
.q2-15 { fill:#e77d6b; }
.q3-15 { fill:#ed9682; }
.q4-15 { fill:#f1ad9a; }
.q5-15 { fill:#f6c8b7; }
.q6-15 { fill:#f6c9b8; }
.q7-15 { fill:#ffffff; }
.q8-15 { fill:#d4e4d0; }
.q9-15 { fill:#b7d1b3; }
.q10-15 { fill:#96bf98; }
.q11-15 { fill:#7aaf82; }
.q12-15 { fill:#5fa26e; }
.q13-15 { fill:#42975c; }
.q14-15 { fill:#1a8e4f; }

</style>
<body>

      <div id = "map">
        <form action="">
          <label for="position">Position:</label>
            <select id = "position">
                 <option value="management">Management</option>
                 <option value="business_finops">Business and Financial Operations</option>
                 <option value="computer_math">Computer and Mathematical</option>
                 <option value="arch_eng">Architecture and Engineering</option>
                 <option value="life_science">Life, Physical, and Social Science</option>
                 <option value="community_service">Community and Social Services</option>
                 <option value="legal">Legal</option>
                 <option value="educ_train_lib">Education, Training, and Library</option>
                 <option value="art_entertainment_design">Business and Financial Operations</option>
                 <option value="healthcare_pract">Healthcare Practitioner and Technical</option>
                 <option value="healthcare_support">Healthcare Support"</option>
                 <option value="protective">Protective Service</option>
                 <option value="food_prep">Food Preparation and Serving</option>
                 <option value="maintenance">Building and Grounds Cleaning and Maintenance</option>
                 <option value="personal_care">Personal Care and Services</option>
                 <option value="sales">Sales and Related</option>
                 <option value="office_admin">Office and Administrative Support</option>
                 <option value="farm_fish_forest">Farming, Fishing, and Forestry</option>
                 <option value="construction">Construction and Extraction</option>
                 <option value="nstall_maint">Installation, Maintenance and Repair</option>
                 <option value="production">Production</option>
                 <option value="transportation">Transportation and Material Moving</option>
        </select><br><br>
        <label for="loan_amount">Loan Amount:</label>
            <input type="text" id="loan_amount" value="17000">
        <br><br>
        <label for="interest_rate">Interest Rate:</label>
            <input type="text" id="interest_rate" value="6">
        <br><br>
        <label for="payoff_period">Payoff Period:</label>
            <input type="text" id="payoff_period" value="10">
        <br><br>
            <label for="weekly_hours_worked">Weekly Hours worked:</label>
            <input type="range"  name="weekly_hours_worked" id="weekly_hours_worked" value="40" min="0" max="100" onchange="showValue(this.value)">
            <span id="weekly_hours_worked_label">40</span><br><br>
          <label for="familz_size">Family Size:</label>
          <select id = "family_size">
            <option value="0">1 Adult</option>
            <option value="1">1 Adult, 1 Child</option>
            <option value="2">1 Adult, 2 Children</option>
            <option value="3">1 Adult, 3 Children</option>
            <option value="4">2 Adults</option>
            <option value="5">2 Adults, 1 Child</option>
            <option value="6">2 Aduls, 2 Children</option>
            <option value="7">2 Adults, 3 Children</option>
          </select></br><br>
        <input type="submit" value="Submit" onclick="printCalculation();return false;">
        </form>

<script src="d3.v3.min.js"></script>
<script src="queue.v1.min.js"></script>
<script src="topojson.v1.min.js"></script>

<script src="https://code.jquery.com/jquery-1.10.2.js"></script>
<script>
var family_size_json
var myjson
function printCalculation(){
    var counties = ["06097","06001","06055","06095","06013","06085","06081","06075","06041"];
    var output = document.createElement("div");

    //Get user inputs
    loan_amount = document.getElementById('loan_amount').value;
    interest_rate = document.getElementById('interest_rate').value;
    payoff_period = document.getElementById('payoff_period').value * 12;
    weekly_hours_worked = document.getElementById('weekly_hours_worked').value;

    
    //calcualte loan payment based on this formula https://www.easycalculation.com/formulas/education-loan-repayment.html (used by the new york times)
    var emi = ((loan_amount * (interest_rate/1200) * Math.pow((1 + interest_rate/1200),  payoff_period)) / (Math.pow((1 + interest_rate/1200), payoff_period) - 1))
    var total_repayment = emi * payoff_period
    if (payoff_period > 0) {
      var monthly_payment = total_repayment/ (payoff_period)
    } else {
      monthly_payment = 0;
    }
    console.log(monthly_payment)

    output.textContent = monthly_payment;

    //use profession input to get correct wage from json file
    $.getJSON("professions.json", function(professions_json) {
        position = document.getElementById('position').value

        //calculate money leftover after loan payment
        monthly_wages = professions_json[position].wage * weekly_hours_worked * 4.333
        money_after_loan = monthly_wages - monthly_payment

        //Load living wage amount by family size json
        $.getJSON("monthlySalaryByCounty.json", function(family_size_json) {
          
          //Get family size
          family_size = document.getElementById('family_size').value

          //Loop through all 9 counties and calculate money left over after loans, cost of living, and wages
          for (i = 0; i < 9; i++ ){
            monthly_expenses = family_size_json[counties[i]].salary[family_size]
            money_final = money_after_loan - monthly_expenses
            updateData(counties[i], money_final/10000);
            console.log(money_final/10000);
          };
        });

        output.textContent = "Money at end of month: $" + Math.round(money_final * 100) / 100;

    });

    //document.body.appendChild(output);
    //updateData();
}

function showValue(newValue)

{
  document.getElementById("weekly_hours_worked_label").innerHTML=newValue;
};

</script>


<script>

var width = 640,
    height = 540;

var rateById = d3.map();

var quantize = d3.scale.quantize()
    .domain([-.2, .2])
    .range(d3.range(15).map(function(i) { return "q" + i + "-15"; }));

var projection = d3.geo.mercator()
      .scale(6000 * 2)
      .center([-122.7, 37.9])
      .translate([width/2, height/2]);

var path = d3.geo.path()
    .projection(projection);

var svg = d3.select("body").append("svg")
    .attr("width", width)
    .attr("height", height);





var sfBaySVG;

queue()
    .defer(d3.json, "caCountiesTopo.json")
    .defer(d3.tsv, "caUnemployment.tsv", function(d) { rateById.set(d.id, +d.rate); })


    .await(ready);

var div = d3.select("#map").append("div")
  .attr("class", "tooltip")
  .style("opacity", 0);

function drawSVG(mapSVG) {
  //Append 'water' rectangle    
  svg.append("rect")
    .attr("width", "100%")
    .attr("height", "100%")
    .attr("fill", "#E0E0EB");
  svg.append("svg:image")
    .attr('x',10)
     .attr('y',160)
     .attr('width', 200)
     .attr('height', 400)
     .attr("xlink:href","legend.png")
  svg.append("g")
      .attr("class", "counties")
    .selectAll("path")
      .data(topojson.feature(mapSVG, mapSVG.objects.subunits).features)
    .enter().append("path")
      .attr("class", function(d) { return quantize(rateById.get(d.id)); })
      .attr("d", path);

}

function ready(error, caCountiesTopo) {
  sfBaySVG = caCountiesTopo;
  drawSVG(sfBaySVG);

}

function updateData(county, value) {
  rateById.set(county, value)
  svg.selectAll("*").remove();
  drawSVG(sfBaySVG);
}

d3.select(self.frameElement).style("height", height + "px");

</script>


</body>