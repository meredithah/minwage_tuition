<!DOCTYPE html>
<meta charset="utf-8">
<style>


.counties {
  fill: none;
}


.q0-9:hover,
.q1-9:hover,
.q2-9:hover,
.q3-9:hover,
.q4-9:hover,
.q5-9:hover,
.q6-9:hover,
.q7-9:hover,
.q8-9:hover {
  opacity: 0.7;
}

.q0-9,
.q1-9,
.q2-9,
.q3-9,
.q4-9,
.q5-9,
.q6-9,
.q7-9,
.q8-9 {
  stroke: white;
  stroke-width: .5px;
}
div.tooltip {
  position: absolute;
  text-align: center;
  width: 75px;
  padding: 2px;
  font: 12px sans-serif;
  color: white;
  background: black;
  border: 0px;
  border-radius: 8px;
  pointer-events: none;
}

.q0-9 { fill:rgb(247,251,255); }
.q1-9 { fill:rgb(222,235,247); }
.q2-9 { fill:rgb(198,219,239); }
.q3-9 { fill:rgb(158,202,225); }
.q4-9 { fill:rgb(107,174,214); }
.q5-9 { fill:rgb(66,146,198); }
.q6-9 { fill:rgb(33,113,181); }
.q7-9 { fill:rgb(8,81,156); }
.q8-9 { fill:rgb(8,48,107); }

</style>
<body>
<script src="d3.v3.min.js"></script>
<script src="queue.v1.min.js"></script>
<script src="topojson.v1.min.js"></script>

<script src="https://code.jquery.com/jquery-1.10.2.js"></script>
<script>
var family_size_json
var myjson
function printCalculation(){
    var counties = ["06097","06001","06055","06095","06013","06085","06081","06075","06041"];
    var output = document.createElement("div");

    //Get user inputs
    loan_amount = document.getElementById('loan_amount').value;
    interest_rate = document.getElementById('interest_rate').value;
    payoff_period = document.getElementById('payoff_period').value * 12;
    weekly_hours_worked = document.getElementById('weekly_hours_worked').value;

    
    //calcualte loan payment based on this formula https://www.easycalculation.com/formulas/education-loan-repayment.html (used by the new york times)
    var emi = ((loan_amount * (interest_rate/1200) * Math.pow((1 + interest_rate/1200),  payoff_period)) / (Math.pow((1 + interest_rate/1200), payoff_period) - 1))
    var total_repayment = emi * payoff_period
    var monthly_payment = total_repayment/ (payoff_period)
    console.log(monthly_payment)

    output.textContent = monthly_payment;

    //use profession input to get correct wage from json file
    $.getJSON("professions.json", function(professions_json) {
        console.log(professions_json);
        position = document.getElementById('position').value
        console.log(professions_json[position])

        //calculate money leftover after loan payment
        monthly_wages = professions_json[position].wage * weekly_hours_worked * 4.333
        money_after_loan = monthly_wages - monthly_payment


        $.getJSON("monthlySalaryByCounty.json", function(family_size_json) {
          family_size = document.getElementById('family_size').value
          myjson = family_size_json
          for (i = 0; i < 9; i++ ){
            //console.log(counties[i]);
            //console.log(family_size_json[counties[i]].salary[family_size]);
            monthly_expenses = family_size_json[counties[i]].salary[family_size]
            money_final = money_after_loan - monthly_expenses
            updateData(counties[i], 10000/money_final);
          };
        });

        output.textContent = "Money after Loan: $" + Math.round(money_after_loan * 100) / 100;

    });

    document.body.appendChild(output);
    //updateData();
}
</script>


<script>

var width = 960,
    height = 600;

var rateById = d3.map();

var quantize = d3.scale.quantize()
    .domain([0, .15])
    .range(d3.range(9).map(function(i) { return "q" + i + "-9"; }));

var projection = d3.geo.mercator()
      .scale(6000 * 2)
      .center([-122, 38])
      .translate([width/2, height/2]);

var path = d3.geo.path()
    .projection(projection);

var svg = d3.select("body").append("svg")
    .attr("width", width)
    .attr("height", height);


var sfBaySVG;

queue()
    .defer(d3.json, "caCountiesTopo.json")
    .defer(d3.tsv, "caUnemployment.tsv", function(d) { rateById.set(d.id, +d.rate); })
    .await(ready);

var div = d3.select("body").append("div")
  .attr("class", "tooltip")
  .style("opacity", 0);

function drawSVG(mapSVG) {
  svg.append("g")
      .attr("class", "counties")
    .selectAll("path")
      .data(topojson.feature(mapSVG, mapSVG.objects.subunits).features)
    .enter().append("path")
      .attr("class", function(d) { return quantize(rateById.get(d.id)); })
      .attr("d", path);
}

function ready(error, caCountiesTopo) {
  sfBaySVG = caCountiesTopo;
  drawSVG(sfBaySVG);
}

function updateData(county, value) {
  rateById.set(county, value)
  svg.selectAll("*").remove();
  drawSVG(sfBaySVG);
}

d3.select(self.frameElement).style("height", height + "px");

</script>

        <form action="">
          <p>Position</p>
            <select id = "position">
                 <option value="management">Management</option>
                 <option value="business_finops">Business and Financial Operations</option>
                 <option value="computer_math">Computer and Mathematical</option>
                 <option value="arch_eng">Architecture and Engineering</option>
                 <option value="life_science">Life, Physical, and Social Science</option>
                 <option value="community_service">Community and Social Services</option>
                 <option value="legal">Legal</option>
                 <option value="educ_train_lib">Education, Training, and Library</option>
                 <option value="art_entertainment_design">Business and Financial Operations</option>
                 <option value="healthcare_pract">Healthcare Practitioner and Technical</option>
                 <option value="healthcare_support">Healthcare Support"</option>
                 <option value="protective">Protective Service</option>
                 <option value="food_prep">Food Preparation and Serving</option>
                 <option value="maintenance">Building and Grounds Cleaning and Maintenance</option>
                 <option value="personal_care">Personal Care and Services</option>
                 <option value="sales">Sales and Related</option>
                 <option value="office_admin">Office and Administrative Support</option>
                 <option value="farm_fish_forest">Farming, Fishing, and Forestry</option>
                 <option value="construction">Construction and Extraction</option>
                 <option value="nstall_maint">Installation, Maintenance and Repair</option>
                 <option value="production">Production</option>
                 <option value="transportation">Transportation and Material Moving</option>
        </select></br>
        Loan Amount:<br>
            <input type="text" id="loan_amount">
        <br>
        Interest Rate:<br>
            <input type="text" id="interest_rate">
        <br>
        Payoff period:<br>
            <input type="text" id="payoff_period">
        <br>
        Weekly Hours Worked:<br>
            <input type="text" id="weekly_hours_worked">
        <br>
          <p>Family Size</p>
          <select id = "family_size">
            <option value="0">1 Adult</option>
            <option value="1">1 Adult, 1 Child</option>
            <option value="2">1 Adult, 2 Children</option>
            <option value="3">1 Adult, 3 Children</option>
            <option value="4">2 Adults</option>
            <option value="5">2 Adults, 1 Child</option>
            <option value="6">2 Aduls, 2 Children</option>
            <option value="7">2 Adults, 3 Children</option>
          </select></br><br>
        <input type="submit" value="Submit" onclick="printCalculation();return false;">
        </form>

</body>